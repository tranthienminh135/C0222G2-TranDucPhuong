<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PRODUCT MANAGER</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>

<!-- Container -->
<div class="container mt-5">

    <!-- Display product -->
    <div class="container mt-5">

        <div>
            <!-- Product title -->
            <h1>VEHICLES</h1>
            <p>Manage product list</p>

        </div>

        <!-- Alert after the product is deleted -->
        <div class="" id="alertDeleteProduct" style="display: none"></div>

        <div class="row">

            <div class="col">

                <!--Search Product-->
                <h3>Search product</h3>

                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Search by name" style="width: 50%"
                           id="searchProduct">
                    <div class="input-group-append">
                        <button class="btn btn-success" type="submit" onclick="searchProduct()">Search</button>
                    </div>
                </div>

            </div>
            <div class="col">

                <!-- Add new product-->
                <h3>Add new product</h3>
                <div class="input-group mb-3 col-xs-3">
                    <button class="btn btn-success" type="button" onclick="" data-toggle="modal"
                            data-target="#myModalAdd">Add new
                        product
                    </button>
                </div>
            </div>

            <div class="col">

                <!-- Cart -->
                <h3>Cart</h3>
                <div class="input-group mb-3 col-xs-3">
                    <button style="font-size:16px" class="btn btn-success" data-toggle="modal"
                            data-target="#myModalCart" onclick="displayCart()">Cart <i class="fa fa-shopping-cart"></i>
                    </button>
                </div>
            </div>

        </div>

        <!-- Alert search product -->
        <div class="" id="alertSearchProduct" style="display: none"></div>

        <!-- Alert Cart product -->
        <div class="" id="alertCart" style="display: none"></div>

        <!-- Product list -->
        <div id="displayProduct"></div>

        <div id="pagination"></div>
    </div>

    <!-- Modal Add New Product -->
    <div class="modal fade" id="myModalAdd" role="dialog">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Add New Product</h2>
                </div>
                <form action="#">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="nameNewProduct">Product Name:</label>
                            <input type="text" class="form-control" id="nameNewProduct">
                        </div>
                        <div class="form-group">
                            <label for="priceNewProduct">Price:</label>
                            <input type="number" class="form-control" id="priceNewProduct">
                        </div>
                        <div class="form-group">
                            <label for="amountNewProduct">Amount:</label>
                            <input type="number" class="form-control" id="amountNewProduct">
                        </div>
                        <div class="alert alert-warning" style="display: none" id="alertAddNewProduct"></div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success" onclick="addNewProduct()" id="addNewProduct">
                        Success
                    </button>
                    <button type="submit" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Edit Product</h2>
                </div>
                <form action="#">
                    <div class="modal-body">
                        <div class="form-group">
                            <input type="text" class="form-control" id="idEditProduct" hidden>
                        </div>
                        <div class="form-group">
                            <label for="nameEditProduct">Product Name:</label>
                            <input type="text" class="form-control" id="nameEditProduct">
                        </div>
                        <div class="form-group">
                            <label for="priceEditProduct">Price:</label>
                            <input type="number" class="form-control" id="priceEditProduct">
                        </div>
                        <div class="form-group">
                            <label for="amountEditProduct">Amount:</label>
                            <input type="number" class="form-control" id="amountEditProduct">
                        </div>
                        <div class="alert alert-warning" style="display: none" id="alertEditProduct"></div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="editProduct()" id="buttonEditSuccess">
                        Success
                    </button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shopping Cart Modal -->
    <div class="modal fade" id="myModalCart" role="dialog">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">My Cart</h2>
                </div>
                <div class="modal-body">
                    <div id="displayCart"></div>
                    <div class="alert alert-warning" style="display: none" id="alertCartProduct"></div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="buyProduct()" id="buttonBuy">
                        Buy
                    </button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script>
    class Product {
        constructor() {
            this.id = 0;
            this.name = "";
            this.price = 0;
            this.amount = 0;
        }

        getId() {
            return this.id;
        }

        setId(id) {
            this.id = id;
        }

        getName() {
            return this.name;
        }

        setName(name) {
            this.name = name;
        }

        getPrice() {
            return this.price;
        }

        setPrice(price) {
            this.price = price;
        }

        getAmount() {
            return this.amount;
        }

        setAmount(amount) {
            this.amount = amount;
        }
    }

    let product1 = new Product();
    product1.setName("Car");
    product1.setPrice(100);
    product1.setAmount(10);

    let product2 = new Product();
    product2.setName("Bike");
    product2.setPrice(200);
    product2.setAmount(5);

    let product3 = new Product();
    product3.setName("Boat");
    product3.setPrice(600);
    product3.setAmount(3);

    let product4 = new Product();
    product4.setName("Motobike");
    product4.setPrice(600);
    product4.setAmount(6);

    let product5 = new Product();
    product5.setName("Ship");
    product5.setPrice(500);
    product5.setAmount(6);

    let product6 = new Product();
    product6.setName("Tank");
    product6.setPrice(1000);
    product6.setAmount(8);

    let product7 = new Product();
    product7.setName("Truck");
    product7.setPrice(4500);
    product7.setAmount(10);

    let myProduct = Array();
    myProduct.push(product1);
    myProduct.push(product2);
    myProduct.push(product3);
    myProduct.push(product4);
    myProduct.push(product5);
    myProduct.push(product6);
    myProduct.push(product7);

    for (let i = 0; i < myProduct.length; i++) {
        myProduct[i].setId(i);
    }
    displayProduct(myProduct);

    function displayProduct(myProduct) {
        let productTable = "<table class=\"table table-hover\">";
        productTable += "<thead>";
        productTable += "<tr>";
        productTable += "<th>ID</th>";
        productTable += "<th>Product Name</th>";
        productTable += "<th>Price</th>";
        productTable += "<th>Amount</th>";
        productTable += "<th>Edit</th>";
        productTable += "<th>Delete</th>";
        productTable += "<th>Add to cart</th>";
        productTable += "</tr>";
        productTable += "</thead>";
        productTable += "<tbody>";
        for (let i = 0; i < myProduct.length; i++) {
            productTable += "<tr>";
            productTable += "<td>" + (myProduct[i].getId() + 1) + "</td>";
            productTable += "<td>" + myProduct[i].getName() + "</td>";
            productTable += "<td>" + "$" + myProduct[i].getPrice() + "</td>";
            productTable += "<td>" + myProduct[i].getAmount() + "</td>";
            productTable += "<td><button type=\"button\" class=\"btn btn-success\" data-toggle=\"modal\" data-target=\"#myModal\" onclick=\"loadProductForEdit(" + myProduct[i].getId() + ")\">Edit</button></td>";
            productTable += "<td><button type=\"button\" id=\"delete\" class=\"btn btn-success\" onclick=\"deleteProduct(" + myProduct[i].getId() + ")\">Delete</button></td>";
            productTable += "<td><button type=\"button\" id=\"delete\" class=\"btn btn-success\" onclick=\"addToCart(" + myProduct[i].getId() + ")\">Add to cart</button></td>";
            productTable += "</tr>";
        }
        productTable += "</tbody>";
        productTable += "</table>";
        displayPagination();
        return document.getElementById("displayProduct").innerHTML = productTable;
    }

    function addNewProduct() {
        let productName = document.getElementById("nameNewProduct").value;
        let productPrice = document.getElementById("priceNewProduct").value;
        let productAmount = document.getElementById("amountNewProduct").value;

        let product = new Product();
        product.setId(myProduct.length);
        product.setName(productName);
        product.setPrice(productPrice);
        product.setAmount(productAmount);

        if (productName === "" || productPrice === "" || productAmount === "") {
            document.getElementById("alertAddNewProduct").style.display = "block";
            document.getElementById("alertAddNewProduct").className = "alert alert-warning";
            document.getElementById("alertAddNewProduct").innerHTML = "Can not be empty!"
        } else {
            myProduct.push(product);
            document.getElementById("nameNewProduct").value = "";
            document.getElementById("priceNewProduct").value = "";
            document.getElementById("amountNewProduct").value = "";
            document.getElementById("alertAddNewProduct").style.display = "block";
            document.getElementById("alertAddNewProduct").className = "alert alert-success";
            document.getElementById("alertAddNewProduct").innerHTML = "Add product success!"

        }
        displayProduct(myProduct);
    }

    function deleteProduct(index) {
        let choice = confirm("Do you want delete " + myProduct[index].getName() + "?");
        if (choice === true) {
            myProduct.splice(index, 1);
            document.getElementById("alertDeleteProduct").className = "alert alert-success";
            document.getElementById("alertDeleteProduct").style.display = "block";
            document.getElementById("alertDeleteProduct").innerHTML = "Delete product success!";
            displayProduct(myProduct);
        }
    }

    function loadProductForEdit(index) {
        document.getElementById("idEditProduct").value = index;
        document.getElementById("nameEditProduct").value = myProduct[index].getName();
        document.getElementById("priceEditProduct").value = myProduct[index].getPrice();
        document.getElementById("amountEditProduct").value = myProduct[index].getAmount();
    }


    function editProduct() {
        let index = document.getElementById("idEditProduct").value;
        let productName = document.getElementById("nameEditProduct").value;
        let productPrice = document.getElementById("priceEditProduct").value;
        let productAmount = document.getElementById("amountEditProduct").value;

        if (productName === "" || productPrice === "" || productAmount === "") {
            document.getElementById("alertEditProduct").className = "alert alert-warning";
            document.getElementById("alertEditProduct").style.display = "block";
            document.getElementById("alertEditProduct").innerHTML = "Cannot be empty!";
        } else {
            document.getElementById("buttonEditSuccess").setAttribute("data-dismiss", "modal");
            myProduct[index].setName(productName);
            myProduct[index].setPrice(productPrice);
            myProduct[index].setAmount(productAmount);
            displayProduct(myProduct);
        }
    }

    function searchProduct() {
        let flag = false;
        searchValue = document.getElementById("searchProduct").value;
        let searchProduct = Array();

        if (searchValue != "") {
            for (let i = 0; i < myProduct.length; i++) {
                if (searchValue.toLowerCase() == myProduct[i].getName().toLowerCase()) {
                    flag = true;
                    break;
                } else {
                    flag = false
                }
            }
            if (flag) {
                for (let i = 0; i < myProduct.length; i++) {
                    if (searchValue.toLowerCase() == myProduct[i].getName().toLowerCase()) {
                        searchProduct.push(myProduct[i]);
                    }
                }
                displayProduct(searchProduct);
            } else {
                document.getElementById("alertSearchProduct").className = "alert alert-warning";
                document.getElementById("alertSearchProduct").style.display = "block";
                document.getElementById("alertSearchProduct").innerHTML = "Product not found!";
            }
        } else {
            displayProduct(myProduct);
            document.getElementById("alertSearchProduct").className = "alert alert-warning";
            document.getElementById("alertSearchProduct").style.display = "block";
            document.getElementById("alertSearchProduct").innerHTML = "Enter the product you want to search!";
        }
        document.getElementById("searchProduct").value = "";
    }


    let managerProductInCart = Array();

    function addToCart(index) {
        if (myProduct[index].getAmount() > 0) {
            document.getElementById("alertCart").style.display = "none";
            let productInCart = new Product();
            productInCart.setId(myProduct[index].getId());
            productInCart.setName(myProduct[index].getName());
            productInCart.setPrice(myProduct[index].getPrice());
            productInCart.setAmount(1);
            managerProductInCart.push(productInCart);
            myProduct[index].setAmount(myProduct[index].getAmount() - 1);
            displayProduct(myProduct);
        } else {
            document.getElementById("alertCart").className = "alert alert-warning";
            document.getElementById("alertCart").style.display = "block";
            document.getElementById("alertCart").innerHTML = "Amount is not enough!";
        }


    }

    function displayCart() {
        let total = 0;
        if (managerProductInCart.length > 1) {
            for (let i = 0; i < managerProductInCart.length; i++) {
                for (let j = i + 1; j < managerProductInCart.length; j++) {
                    if (managerProductInCart[i].getId() === managerProductInCart[j].getId()) {
                        managerProductInCart.splice(j, 1);
                        j--;
                        managerProductInCart[i].setAmount(managerProductInCart[i].getAmount() + 1);
                    }
                }
            }
        }

        for (let i = 0; i < managerProductInCart.length; i++) {
            total += managerProductInCart[i].getPrice() * managerProductInCart[i].getAmount();
        }

        document.getElementById("alertCartProduct").style.display = "none";
        let productCartTable = "<table class=\"table table-hover\" style=\"font-size: 18px\">";
        productCartTable += "<thead>";
        productCartTable += "<tr>";
        productCartTable += "<th>ID</th>";
        productCartTable += "<th>Product Name</th>";
        productCartTable += "<th>Price</th>";
        productCartTable += "<th>Amount</th>";
        productCartTable += "<th>Action</th>";
        productCartTable += "</tr>";
        productCartTable += "</thead>";
        productCartTable += "<tbody>";
        for (let i = 0; i < managerProductInCart.length; i++) {
            productCartTable += "<tr>";
            productCartTable += "<td>" + (managerProductInCart[i].getId() + 1) + "</td>";
            productCartTable += "<td>" + managerProductInCart[i].getName() + "</td>";
            productCartTable += "<td>" + "$" + managerProductInCart[i].getPrice() + "</td>";
            productCartTable += "<td> <button type=\"submit\" class=\"btn btn-default\" onclick=\"additionCart(" + i + ")\">+</button> " + managerProductInCart[i].getAmount() + " <button type=\"submit\" class=\"btn btn-default\" onclick=\"subtractionCart(" + i + ")\">-</button></td>";
            productCartTable += "<td><button type=\"submit\" class=\"btn btn-danger\" onclick=\"deleteProductInCart(" + i + ")\">Delete</button></td>";
            productCartTable += "</tr>";
        }
        productCartTable += "</tbody>";
        productCartTable += "</table>";
        productCartTable += "<h3>Total: <span id=\"totalProductInCart\">" + "$" + total.toLocaleString() + "</span> </h3>"
        return document.getElementById("displayCart").innerHTML = productCartTable;

    }

    function additionCart(index) {
        if (myProduct[managerProductInCart[index].getId()].getAmount() > 0) {
            managerProductInCart[index].setAmount(managerProductInCart[index].getAmount() + 1);
            myProduct[managerProductInCart[index].getId()].setAmount(myProduct[managerProductInCart[index].getId()].getAmount() - 1);
            displayCart();
            displayProduct(myProduct);
        } else {
            document.getElementById("alertCartProduct").style.display = "block";
            document.getElementById("alertCartProduct").className = "alert alert-warning";
            document.getElementById("alertCartProduct").innerHTML = "Maximum amount!"
        }

    }

    function subtractionCart(index) {
        if (managerProductInCart[index].getAmount() > 0) {
            managerProductInCart[index].setAmount(managerProductInCart[index].getAmount() - 1);
            myProduct[managerProductInCart[index].getId()].setAmount(myProduct[managerProductInCart[index].getId()].getAmount() + 1);
            displayCart();
            displayProduct(myProduct);
        } else {
            let choice = confirm("Do you want remove product " + managerProductInCart[index].getName() + " ?");
            if (choice) {
                managerProductInCart.splice(index, 1);
                displayCart();
                displayProduct(myProduct);
            }
        }
    }

    function deleteProductInCart(index) {
        let choice = confirm("Do you want remove product " + managerProductInCart[index].getName() + " ?");
        if (choice) {
            myProduct[managerProductInCart[index].getId()].setAmount(myProduct[managerProductInCart[index].getId()].getAmount() + managerProductInCart[index].getAmount())
            managerProductInCart.splice(index, 1);
            displayCart();
            displayProduct(myProduct);
        }
    }

    function buyProduct() {
        managerProductInCart = [];
        displayCart();
        displayProduct(myProduct);
    }

    function displayPagination() {
        let count = myProduct.length / 3;
        if (myProduct.length % 3 !== 0) {
            count++;
        }
        count = parseInt(count);

        let paginationTable = "<ul class=\"pagination\">";
        paginationTable += "<li><a href=\"#\">Previous</a></li>";
        for (let i = 0; i < count; i++) {
            paginationTable += "<li><a href=\"#\" onclick=\"loadPagination(" + i + ")\">" + (i + 1) + "</a></li>";
        }
        paginationTable += "<li><a href=\"#\">Next</a></li>";
        paginationTable += "</ul>";

        document.getElementById("pagination").innerHTML = paginationTable;

        return count;
    }

    function loadPagination(index) {

    }
</script>